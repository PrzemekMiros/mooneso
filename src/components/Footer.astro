---
import logo from "../assets/images/global/logo.png";
import cookieModalUrl from "../scripts/cookie-modal.js?url";
import gsapUrl from "../scripts/libs/gsap.js?url";
import scrollTriggerUrl from "../scripts/libs/scroll-trigger.js?url";
import splitTextUrl from "../scripts/libs/split-text.js?url";
import lenisUrl from "../scripts/libs/lenis.js?url";
import animationsUrl from "../scripts/animations.js?url";
---

<footer class="relative pb-12 pt-28 z-0">
  <div class="pointer-events-none absolute -z-1 inset-y-0 left-1/2 w-screen -translate-x-1/2 bg-[#E0DED7]"></div>
  <div class="footer-parallax relative max-w-7xl mx-auto">
    
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-10 mb-6">
      <div>
        <p class="font-semibold uppercase mb-6">Pomoc</p>
        <ul class="space-y-2">
          <li><a href="/realizacje/" class="text-gray-500 hover:text-black transition-colors" title="Realizacje">Realizacje</a></li>
          <li><a href="/produkty/" class="text-gray-500 hover:text-black transition-colors" title="Produkty">Produkty</a></li>
          <li><a href="/opinie/" class="text-gray-500 hover:text-black transition-colors" title="Opinie">Opinie</a></li>
        </ul>
      </div>

      <div>
        <p class="font-semibold uppercase mb-6">Katalog</p>
        <ul class="space-y-2">
          <li><a href="/realizacje/" class="text-gray-500 hover:text-black transition-colors" title="Realizacje">Realizacje</a></li>
          <li><a href="/produkty/" class="text-gray-500 hover:text-black transition-colors" title="Produkty">Produkty</a></li>
          <li><a href="/opinie/" class="text-gray-500 hover:text-black transition-colors" title="Opinie">Opinie</a></li>
        </ul>
      </div>

      <div>
        <p class="font-semibold uppercase mb-6">Współpraca</p>
        <ul class="space-y-2">
          <li><a href="/realizacje/" class="text-gray-500" title="Realizacje">Realizacje</a></li>
          <li><a href="/produkty/" class="text-gray-500 hover:text-black transition-colors" title="Produkty">Produkty</a></li>
          <li><a href="/opinie/" class="text-gray-500 hover:text-black transition-colors" title="Opinie">Opinie</a></li>
        </ul>
      </div>

      <div class="space-y-2">
        <p class="font-semibold uppercase mb-6">Kontakt</p>
          <p class="font-sm text-gray-500">kontakt@mooneso.pl</p>
          <p class="font-sm text-gray-500">+48 500 500 </p>
          <p class="font-sm text-gray-500">03-860 Warszawa</p>
      </div>
    </div>

    <h6 class="text-[18vw] md:text-[9rem] lg:text-[12rem] xl:text-[17rem] text-center tracking-tighter text-black uppercase">
      Mooneso
    </h6>

    <div class="flex flex-col md:flex-row justify-between md:items-center border-t border-black/15 mt-6 pt-12 gap-6">
      <div class="flex flex-wrap justify-left gap-6 text-[11px]">
        <a href="#" class="hover:text-white transition-colors" title="Pliki cookies" data-cookie-open>Pliki cookies</a>
      </div>
    </div>
  </div>
</footer>

<div
  class="fixed inset-0 hidden bg-black/10 flex items-center justify-center z-[9999] p-4 font-sans text-left"
  data-cookie-modal
  aria-hidden="true"
  role="dialog"
  aria-modal="true"
  aria-labelledby="cookieconsent-title"
  tabindex="-1"
>
  <div class="bg-white rounded-lg shadow-2xl max-w-[600px] w-full overflow-hidden border border-gray-200">
    <div class="p-6 md:p-8 flex border-b border-gray-300">
      <div class="flex flex-col">
        <span id="cookieconsent-title" class="text-lg font-semibold text-gray-900 leading-tight">Strona używa plików cookie</span>
      </div>
    </div>

    <div class="px-6 md:px-8 flex border-b border-gray-300" role="tablist" aria-label="Cookie consent">
      <button class="flex-1 py-3 text-[var(--accent)] font-bold text-[11px] uppercase tracking-wider border-b-2 border-[var(--accent)] cursor-pointer" type="button" data-cookie-tab="consent" role="tab" id="cookie-tab-consent" aria-controls="cookie-panel-consent" aria-selected="true">
        Zgoda
      </button>
      <button class="flex-1 py-3 text-[var(--accent)] font-bold text-[11px] uppercase tracking-wider border-b-2 border-[var(--accent)] cursor-pointer text-[#00a3ff]" type="button" data-cookie-tab="details" role="tab" id="cookie-tab-details" aria-controls="cookie-panel-details" aria-selected="false">
        Szczegóły
      </button>
      <button class="flex-1 py-3 text-[var(--accent)] font-bold text-[11px] uppercase tracking-wider border-b-2 border-[var(--accent)] cursor-pointer text-[#00a3ff]" type="button" data-cookie-tab="about" role="tab" id="cookie-tab-about" aria-controls="cookie-panel-about" aria-selected="true">
        Info
      </button>
    </div>

    <div class="p-6 md:p-8" data-cookie-panel="consent" role="tabpanel" id="cookie-panel-consent" aria-labelledby="cookie-tab-consent">
      <p class="text-gray-500 text-[12px] leading-[1.6]">
        Strona używa plików cookie, aby personalizować treści, udostępniać funkcje mediów społecznościowych i analizować ruch. Udostępnia również informacje o tym, jak korzystasz z witryny, naszym partnerom społecznościowym, reklamowym i analitycznym.
      </p>
    </div>

    <div class="p-6 md:p-8 hidden" data-cookie-panel="details" role="tabpanel" id="cookie-panel-details" aria-labelledby="cookie-tab-details">
      <p class="text-gray-500 text-[12px] leading-[1.6] mb-4">
        Wybierz, na jakie kategorie plików cookie wyrażasz zgodę. Niezbędne są zawsze aktywne.
      </p>
      <div class="space-y-3 text-[12px] text-gray-700">
        <label class="flex items-center justify-between rounded border border-gray-200 px-3 py-2">
          <span>Niezbędne</span>
          <span class="flex items-center gap-2">
            <span class="text-[10px] uppercase tracking-wider text-gray-500">Zawsze aktywne</span>
            <input type="checkbox" checked disabled data-cookie-category="necessary" aria-label="Niezbędne" class="h-4 w-4 rounded border-gray-300 text-[var(--accent)] focus:ring-2 focus:ring-[var(--accent)] disabled:cursor-not-allowed disabled:opacity-60" />
          </span>
        </label>
        <label class="flex items-center justify-between rounded border border-gray-200 px-3 py-2">
          <span>Funkcjonalne</span>
          <input type="checkbox" data-cookie-category="functional" aria-label="Funkcjonalne" class="h-4 w-4 rounded border-gray-300 text-[var(--accent)] focus:ring-2 focus:ring-[var(--accent)]" />
        </label>
        <label class="flex items-center justify-between rounded border border-gray-200 px-3 py-2">
          <span>Analityczne</span>
          <input type="checkbox" data-cookie-category="analytics" aria-label="Analityczne" class="h-4 w-4 rounded border-gray-300 text-[var(--accent)] focus:ring-2 focus:ring-[var(--accent)]" />
        </label>
        <label class="flex items-center justify-between rounded border border-gray-200 px-3 py-2">
          <span>Marketingowe</span>
          <input type="checkbox" data-cookie-category="marketing" aria-label="Marketingowe" class="h-4 w-4 rounded border-gray-300 text-[var(--accent)] focus:ring-2 focus:ring-[var(--accent)]" />
        </label>
      </div>
      <div class="mt-5">
        <button class="cursor-pointer w-full bg-[var(--accent)] text-white font-bold py-3 px-4 rounded-lg transition-colors text-[11px] uppercase tracking-wide" type="button" data-cookie-save>
          Zapisz ustawienia
        </button>
      </div>
    </div>

    <div class="p-6 md:p-8 hidden" data-cookie-panel="about" role="tabpanel" id="cookie-panel-about" aria-labelledby="cookie-tab-about">
      <p class="text-gray-500 text-[12px] leading-[1.6]">
        Pliki cookie to niewielkie informacje zapisywane w Twojej przeglądarce. Pomagają działać stronie,
        zapamiętywać ustawienia oraz mierzyć ruch. Możesz zmienić zgodę w każdej chwili w ustawieniach.
      </p>
    </div>

    <div class="p-6 md:p-8 pt-0 flex flex-col md:flex-row gap-2">
      <button class="cursor-pointer flex-1 bg-[var(--accent)] text-white font-bold py-3 px-4 rounded-lg transition-colors text-[11px] uppercase tracking-wide" type="button" data-cookie-deny>
        Odmów
      </button>
      <button class="cursor-pointer flex-1 bg-[var(--accent)] text-white font-bold py-3 px-4 rounded-lg transition-colors text-[11px] uppercase tracking-wide flex items-center justify-center gap-1" type="button" data-cookie-customize>
        Dostosuj
        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
      <button class="cursor-pointer flex-1 bg-[var(--accent)] text-white font-bold py-3 px-4 rounded-lg transition-colors text-[11px] uppercase tracking-wide" type="button" data-cookie-accept>
        Zezwól
      </button>
    </div>
  </div>
</div>

<div class="circle-container hidden md:flex items-center justify-center">
		<svg class="circle-progress svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
			<path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
		</svg>
    <svg class="h-4 w-4 text-white absolute top-4 left-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="var(--accent)">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
    </svg>
</div>

<script>
(() => {
  const initCircleProgress = () => {
    const circleContainer = document.querySelector(".circle-container");
    if (!circleContainer) return;

    const circlePath = circleContainer.querySelector("path");
    if (!circlePath) return;

    const offset = 50;
    const pathLength = circlePath.getTotalLength();

    circlePath.style.transition = circlePath.style.WebkitTransition = "none";
    circlePath.style.strokeDasharray = pathLength;
    circlePath.style.strokeDashoffset = pathLength;
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        circlePath.style.transition = circlePath.style.WebkitTransition =
          "stroke-dashoffset 10ms linear";
      });
    });

    const updateLoader = (scrollTop) => {
      const docHeight = document.documentElement.scrollHeight;
      const winHeight = window.innerHeight;
      const height = Math.max(1, docHeight - winHeight);
      const progress = pathLength - (scrollTop * pathLength) / height;
      circlePath.style.strokeDashoffset = progress;

      if (scrollTop > offset) {
        circleContainer.classList.add("active");
      } else {
        circleContainer.classList.remove("active");
      }
    };

    const setScrollingState = (isScrolling) => {
      circleContainer.classList.toggle("is-scrolling", Boolean(isScrolling));
    };

    if (window.__circleScrollHandler) {
      window.removeEventListener("scroll", window.__circleScrollHandler);
      window.__circleScrollHandler = null;
    }
    if (window.__circleScrollTimeout) {
      window.clearTimeout(window.__circleScrollTimeout);
      window.__circleScrollTimeout = null;
    }
    if (window.__circleScrollElement && window.__circleScrollClickHandler) {
      window.__circleScrollElement.removeEventListener("click", window.__circleScrollClickHandler);
    }
    if (window.__circleLenisUnsub) {
      window.__circleLenisUnsub();
      window.__circleLenisUnsub = null;
    }
    if (window.__circleLenisWatchTimer) {
      window.clearInterval(window.__circleLenisWatchTimer);
      window.__circleLenisWatchTimer = null;
    }

    const onClick = () => {
      const lenis = window.__lenisInstance;
      if (lenis && typeof lenis.scrollTo === "function") {
        lenis.scrollTo(0);
      } else {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    };
    window.__circleScrollElement = circleContainer;
    window.__circleScrollClickHandler = onClick;
    circleContainer.addEventListener("click", onClick);

    const attachNativeScroll = () => {
      let ticking = false;
      const markScrolling = () => {
        circleContainer.classList.add("is-scrolling");
        if (window.__circleScrollTimeout) {
          window.clearTimeout(window.__circleScrollTimeout);
        }
        window.__circleScrollTimeout = window.setTimeout(() => {
          circleContainer.classList.remove("is-scrolling");
        }, 150);
      };

      const onScroll = () => {
        if (ticking) return;
        ticking = true;
        requestAnimationFrame(() => {
          const scrollTop = window.scrollY || document.documentElement.scrollTop;
          updateLoader(scrollTop);
          markScrolling();
          ticking = false;
        });
      };

      window.__circleScrollHandler = onScroll;
      window.addEventListener("scroll", onScroll, { passive: true });
      updateLoader(window.scrollY || document.documentElement.scrollTop);
    };

    const attachLenisScroll = (lenis) => {
      if (!lenis || typeof lenis.on !== "function") return false;
      window.__circleLenisUnsub = lenis.on("scroll", (instance) => {
        const scrollTop = instance.scroll;
        updateLoader(scrollTop);
        setScrollingState(instance.isScrolling);
      });
      updateLoader(lenis.scroll);
      setScrollingState(lenis.isScrolling);
      return true;
    };

    const lenis = window.__lenisInstance;
    if (!attachLenisScroll(lenis)) {
      attachNativeScroll();
      window.__circleLenisWatchTimer = window.setInterval(() => {
        const liveLenis = window.__lenisInstance;
        if (attachLenisScroll(liveLenis)) {
          if (window.__circleScrollHandler) {
            window.removeEventListener("scroll", window.__circleScrollHandler);
            window.__circleScrollHandler = null;
          }
          if (window.__circleScrollTimeout) {
            window.clearTimeout(window.__circleScrollTimeout);
            window.__circleScrollTimeout = null;
          }
          window.clearInterval(window.__circleLenisWatchTimer);
          window.__circleLenisWatchTimer = null;
        }
      }, 200);
    }
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initCircleProgress, { once: true });
  } else {
    initCircleProgress();
  }

  ["swup:contentReplaced", "swup:page:view"].forEach((evt) =>
    document.addEventListener(evt, initCircleProgress)
  );
})();
</script>

<script src={gsapUrl} defer></script>
<script src={scrollTriggerUrl} defer></script>
<script src={splitTextUrl} defer></script>
<script src={lenisUrl} defer></script>
<script src={animationsUrl} defer></script>
<script is:inline>
  (async () => {
    const libs = [
      { name: "gsap", url: "{gsapUrl}" },
      { name: "ScrollTrigger", url: "{scrollTriggerUrl}" },
      { name: "SplitText", url: "{splitTextUrl}" },
      { name: "Lenis", url: "{lenisUrl}" },
      { name: "animationMain", url: "{animationsUrl}" },
    ];

    const loadScriptOnce = (name, url) =>
      new Promise((resolve) => {
        if (window[name]) return resolve();
        const existing = document.querySelector(`script[data-inline-lib="${name}"]`);
        if (existing) {
          existing.addEventListener("load", () => resolve(), { once: true });
          return;
        }
        const s = document.createElement("script");
        s.src = url;
        s.defer = true;
        s.dataset.inlineLib = name;
        s.onload = resolve;
        document.head.appendChild(s);
      });

    const bootAnimations = async () => {
      await Promise.all(libs.map((lib) => loadScriptOnce(lib.name, lib.url)));
      if (typeof window.animationMain === "function") {
        window.animationMain();
      }
    };

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", bootAnimations, { once: true });
    } else {
      await bootAnimations();
    }

    ["swup:contentReplaced", "swup:page:view"].forEach((evt) =>
      document.addEventListener(evt, bootAnimations)
    );
  })();
</script>
<script src={cookieModalUrl} defer></script>

